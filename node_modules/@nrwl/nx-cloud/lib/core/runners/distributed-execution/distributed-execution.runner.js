const a8_0x41b4=['Successfully\x20completed\x20running\x20the\x20command.','Command\x20execution\x20failed.','completedTasks','retrieve','start','getNxCacheDirectory','./task-graph-creator','taskGraph','stdout','exit','assign','target','toString','./split-task-graph-into-stages','No\x20new\x20completed\x20tasks\x20after\x20','createUnchangedValueTimeout','../../../utilities/nx-imports','/nx.json','configuration','ErrorReporterApi','status','project','Retrieving\x20artifacts\x20from\x20','projectGraph','Status\x20update','values','Main\x20job\x20was\x20terminated\x20via\x20SIGTERM','lifeCycle','ENCRYPTION_KEY','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','logCommand','VERBOSE_LOGGING','executionId:\x20','throw','strip-json-comments','Waiting...','log','Waiter','createTaskGraph','readFileSync','Unable\x20to\x20complete\x20a\x20run.','get','commandStatus','completeRunGroupWithError','endTask','See\x20run\x20details\x20at\x20','TaskGraphCreator','Main\x20job\x20was\x20terminated\x20via\x20SIGINT','write','reset','tasks','Processing\x20task\x20','join','FileStorage','taskId','DistributedExecutionApi','success','note','../../api/error-reporter.api','encryptionKey','serializeOverrides','NO_COMPLETED_TASKS_TIMEOUT','criticalErrorMessage','addVerticalSeparator','__awaiter','./distributed-execution.api','wait','printRunGroupError','Starting\x20distributed\x20command\x20execution','value','startTask','createStartRequest','nodes','dependencies','length','nxCloudDistributedTasksRunner','copyFilesFromCache','getRunGroup','submitRunMetrics','axiosException','defineProperty','error:\x20','../../../utilities/environment','runUrl','message','error','find','COMPLETED','E2EEncryption','splitTasksIntoStages','hash','push','../../../utilities/create-unchanged-value-timeout'];(function(_0x4fcfd7,_0x41b4a9){const _0x449583=function(_0x34fdee){while(--_0x34fdee){_0x4fcfd7['push'](_0x4fcfd7['shift']());}};_0x449583(++_0x41b4a9);}(a8_0x41b4,0x1b3));const a8_0x4495=function(_0x4fcfd7,_0x41b4a9){_0x4fcfd7=_0x4fcfd7-0x0;let _0x449583=a8_0x41b4[_0x4fcfd7];return _0x449583;};'use strict';var __awaiter=this&&this[a8_0x4495('0x1')]||function(_0x2ca21f,_0x3fca69,_0x1680d1,_0x334354){function _0x2569e9(_0x4ea03f){return _0x4ea03f instanceof _0x1680d1?_0x4ea03f:new _0x1680d1(function(_0x5813f9){_0x5813f9(_0x4ea03f);});}return new(_0x1680d1||(_0x1680d1=Promise))(function(_0x379ec8,_0x3702d0){function _0xd9d814(_0x624449){try{_0x3c8884(_0x334354['next'](_0x624449));}catch(_0x4ec7b1){_0x3702d0(_0x4ec7b1);}}function _0x10dbb9(_0x1cce7a){try{_0x3c8884(_0x334354[a8_0x4495('0x3f')](_0x1cce7a));}catch(_0x598e0a){_0x3702d0(_0x598e0a);}}function _0x3c8884(_0xcc228a){_0xcc228a['done']?_0x379ec8(_0xcc228a[a8_0x4495('0x6')]):_0x2569e9(_0xcc228a[a8_0x4495('0x6')])['then'](_0xd9d814,_0x10dbb9);}_0x3c8884((_0x334354=_0x334354['apply'](_0x2ca21f,_0x3fca69||[]))['next']());});};Object[a8_0x4495('0x11')](exports,'__esModule',{'value':!![]});exports[a8_0x4495('0xc')]=void 0x0;const fs_1=require('fs');const stripJsonComments=require(a8_0x4495('0x40'));const create_unchanged_value_timeout_1=require(a8_0x4495('0x1d'));const environment_1=require(a8_0x4495('0x13'));const metric_logger_1=require('../../../utilities/metric-logger');const serializer_overrides_1=require('../../../utilities/serializer-overrides');const waiter_1=require('../../../utilities/waiter');const error_reporter_api_1=require(a8_0x4495('0x58'));const print_run_group_error_1=require('../../error/print-run-group-error');const e2e_encryption_1=require('../../file-storage/e2e-encryption');const file_storage_1=require('../../file-storage/file-storage');const distributed_execution_api_1=require(a8_0x4495('0x2'));const split_task_graph_into_stages_1=require(a8_0x4495('0x2b'));const task_graph_creator_1=require(a8_0x4495('0x24'));const {output,workspaceRoot,getOutputs,Cache}=require(a8_0x4495('0x2e'));class NoopLifeCycle{['scheduleTask'](_0x586375){}[a8_0x4495('0x7')](_0x4dc34d){}[a8_0x4495('0x4a')](_0x17429e,_0x277874){}}function runDistributedExecution(_0x9cf60b,_0x59ca16,_0x4086d2,_0x36010e,_0x133d6a,_0x4abfd5,_0xa38920){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2d5a9e=yield _0x9cf60b[a8_0x4495('0x22')]((0x0,distributed_execution_api_1[a8_0x4495('0x8')])(_0x4abfd5,(0x0,split_task_graph_into_stages_1[a8_0x4495('0x1a')])(_0xa38920),_0x59ca16));return yield processTasks(_0x9cf60b,_0x36010e,_0x133d6a,_0x59ca16,_0x2d5a9e,Object[a8_0x4495('0x37')](_0xa38920[a8_0x4495('0x50')]),_0x4086d2);});}function processTasks(_0x2ab75f,_0x1649c9,_0x197115,_0x45e740,_0x2148cb,_0x2a0e9c,_0x2a89b3){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x10c965={};const _0x33b79c=(0x0,create_unchanged_value_timeout_1[a8_0x4495('0x2d')])({'title':a8_0x4495('0x2c')+environment_1[a8_0x4495('0x5b')]/0x3e8+'\x20seconds.','timeout':environment_1[a8_0x4495('0x5b')]});const _0x797f96=new waiter_1[(a8_0x4495('0x43'))]();while(!![]){if(environment_1['VERBOSE_LOGGING']){output[a8_0x4495('0x57')]({'title':a8_0x4495('0x41')});}yield _0x797f96[a8_0x4495('0x3')]();const _0x2eefe9=yield _0x2ab75f[a8_0x4495('0x32')](_0x2148cb);if(environment_1['VERBOSE_LOGGING']){output[a8_0x4495('0x57')]({'title':a8_0x4495('0x36'),'bodyLines':[a8_0x4495('0x3e')+_0x2148cb,'executionStatus:\x20'+_0x2eefe9['executionStatus'],'number\x20of\x20completed\x20tasks:\x20'+_0x2eefe9[a8_0x4495('0x20')][a8_0x4495('0xb')],a8_0x4495('0x12')+_0x2eefe9[a8_0x4495('0x5c')]]});}if(_0x2eefe9[a8_0x4495('0x5c')]){output[a8_0x4495('0x16')]({'title':'Distributed\x20Execution\x20Terminated','bodyLines':['Error:',_0x2eefe9['criticalErrorMessage']]});process[a8_0x4495('0x27')](0x1);}_0x33b79c(_0x2eefe9['completedTasks']['length']);for(const _0x250e97 of _0x2eefe9[a8_0x4495('0x20')]){if(_0x10c965[_0x250e97[a8_0x4495('0x54')]])continue;yield processTask(_0x1649c9,_0x197115,_0x2a89b3,_0x45e740,_0x2a0e9c,_0x250e97);_0x797f96[a8_0x4495('0x4f')]();_0x10c965[_0x250e97['taskId']]=!![];}if(_0x2eefe9['executionStatus']===a8_0x4495('0x18')){return{'commandStatus':_0x2eefe9[a8_0x4495('0x48')],'runUrl':_0x2eefe9['runUrl']};}}});}function processTask(_0x35ed4f,_0x48b503,_0xc208ec,_0x483b8a,_0x458335,_0x3a2540){return __awaiter(this,void 0x0,void 0x0,function*(){if(environment_1['VERBOSE_LOGGING']){output[a8_0x4495('0x57')]({'title':a8_0x4495('0x51')+_0x3a2540[a8_0x4495('0x54')]});}const _0x155b9e=_0x458335[a8_0x4495('0x17')](_0x287f60=>_0x3a2540[a8_0x4495('0x54')]===_0x287f60['id']);if(!_0x155b9e){throw new Error('Found\x20unknown\x20task:\x20'+_0x3a2540['taskId']);}if(environment_1['VERBOSE_LOGGING']){output[a8_0x4495('0x57')]({'title':a8_0x4495('0x34')+_0x3a2540['url']});}yield _0x35ed4f[a8_0x4495('0x21')](_0x3a2540[a8_0x4495('0x1b')],_0x3a2540['url'],(0x0,environment_1[a8_0x4495('0x23')])(_0x483b8a));const _0x498ab=yield _0x48b503[a8_0x4495('0x47')](Object[a8_0x4495('0x28')](Object[a8_0x4495('0x28')]({},_0x155b9e),{'hash':_0x3a2540['hash']}));const _0x2eee38=getOutputs(_0xc208ec[a8_0x4495('0x35')][a8_0x4495('0x9')],_0x155b9e);if(environment_1['VERBOSE_LOGGING']){output[a8_0x4495('0x57')]({'title':'Extracting\x20artifacts','bodyLines':_0x2eee38});}yield _0x48b503[a8_0x4495('0xd')](_0x3a2540[a8_0x4495('0x1b')],_0x498ab,_0x2eee38);output[a8_0x4495('0x3c')](getCommand(_0x155b9e));process[a8_0x4495('0x26')][a8_0x4495('0x4e')](_0x498ab['terminalOutput']);output[a8_0x4495('0x0')]();});}function getCommand(_0x282b4d){const _0x417765=_0x282b4d[a8_0x4495('0x29')][a8_0x4495('0x30')]?':'+_0x282b4d[a8_0x4495('0x29')][a8_0x4495('0x30')]:'';return['nx','run',_0x282b4d[a8_0x4495('0x29')][a8_0x4495('0x33')]+':'+_0x282b4d[a8_0x4495('0x29')][a8_0x4495('0x29')]+_0x417765,(0x0,serializer_overrides_1[a8_0x4495('0x5a')])(_0x282b4d)][a8_0x4495('0x52')]('\x20');}function attachSignalListenersToCompleteRunGroupOnError(_0x1cef8f,_0x140bcd){process['on']('SIGINT',()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x1cef8f[a8_0x4495('0x49')](_0x140bcd,a8_0x4495('0x4d'));process[a8_0x4495('0x27')](0x1);}));process['on']('SIGTERM',()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x1cef8f[a8_0x4495('0x49')](_0x140bcd,a8_0x4495('0x38'));process[a8_0x4495('0x27')](0x1);}));}const nxCloudDistributedTasksRunner=(_0x50cafd,_0x78ca43,_0x429e11)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(environment_1[a8_0x4495('0x3d')]){output['note']({'title':a8_0x4495('0x5')});}_0x78ca43[a8_0x4495('0x39')]=new NoopLifeCycle();const _0x55deea=(0x0,environment_1[a8_0x4495('0xe')])();if(!_0x55deea){(0x0,print_run_group_error_1[a8_0x4495('0x4')])();return process['exit'](0x1);}const _0x2d7f85=new e2e_encryption_1[(a8_0x4495('0x19'))](environment_1[a8_0x4495('0x3a')]||_0x78ca43[a8_0x4495('0x59')]);const _0x291deb=new error_reporter_api_1[(a8_0x4495('0x31'))](_0x78ca43);const _0x197f93=new file_storage_1[(a8_0x4495('0x53'))](_0x2d7f85,_0x291deb,!![],![]);const _0x13abfc=new Cache(_0x78ca43);const _0x190c46=new distributed_execution_api_1[(a8_0x4495('0x55'))](_0x78ca43);attachSignalListenersToCompleteRunGroupOnError(_0x190c46,_0x55deea);try{const _0x41e5ba=getTaskGraph(_0x429e11,_0x50cafd,_0x78ca43);const _0x157f72=yield runDistributedExecution(_0x190c46,_0x78ca43,_0x429e11,_0x197f93,_0x13abfc,_0x55deea,_0x41e5ba);if(_0x157f72[a8_0x4495('0x48')]===0x0){output[a8_0x4495('0x56')]({'title':a8_0x4495('0x1e'),'bodyLines':[a8_0x4495('0x4b')+_0x157f72[a8_0x4495('0x14')]]});}else{output[a8_0x4495('0x16')]({'title':a8_0x4495('0x1f'),'bodyLines':[a8_0x4495('0x4b')+_0x157f72[a8_0x4495('0x14')]]});}yield(0x0,metric_logger_1[a8_0x4495('0xf')])(_0x78ca43);process['exit'](_0x157f72[a8_0x4495('0x48')]);}catch(_0xeb031e){output[a8_0x4495('0x16')]({'title':a8_0x4495('0x46'),'bodyLines':[_0xeb031e[a8_0x4495('0x15')]]});if(_0xeb031e[a8_0x4495('0x10')]){console['log'](_0xeb031e[a8_0x4495('0x10')]);}else{console[a8_0x4495('0x42')](_0xeb031e);}try{yield _0x190c46[a8_0x4495('0x49')](_0x55deea,a8_0x4495('0x3b')+_0xeb031e['message']+'\x22');}finally{process[a8_0x4495('0x27')](0x1);}}});exports[a8_0x4495('0xc')]=nxCloudDistributedTasksRunner;function getTaskGraph(_0x230759,_0x358a10,_0x5e2189){if(_0x230759[a8_0x4495('0x25')]){return _0x230759[a8_0x4495('0x25')];}else{const _0x4532fe=JSON['parse'](stripJsonComments((0x0,fs_1[a8_0x4495('0x45')])(workspaceRoot+a8_0x4495('0x2f'))[a8_0x4495('0x2a')]()));return new task_graph_creator_1[(a8_0x4495('0x4c'))](_0x230759[a8_0x4495('0x35')],getDefaultDependencyConfigs(_0x4532fe,_0x5e2189))[a8_0x4495('0x44')](_0x358a10);}}function getDefaultDependencyConfigs(_0x2c8a21,_0x5d76ee){var _0x512581,_0xf2d6fc;const _0x4c76d4=(_0x512581=_0x2c8a21['targetDependencies'])!==null&&_0x512581!==void 0x0?_0x512581:{};const _0x574249=_0x5d76ee?(_0xf2d6fc=_0x5d76ee['strictlyOrderedTargets'])!==null&&_0xf2d6fc!==void 0x0?_0xf2d6fc:['build']:[];for(const _0x161325 of _0x574249){_0x4c76d4[_0x161325]=_0x4c76d4[_0x161325]||[];_0x4c76d4[_0x161325][a8_0x4495('0x1c')]({'target':_0x161325,'projects':a8_0x4495('0xa')});}return _0x4c76d4;}