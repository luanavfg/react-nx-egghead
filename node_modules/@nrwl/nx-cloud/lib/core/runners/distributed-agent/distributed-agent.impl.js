const a6_0x1fcd=['options','getNxCacheDirectory','exit','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','retryDuring','NX_AGENT_NAME','../../../utilities/nx-imports','status:\x20','Duplicate\x20Agent\x20ID\x20Detected','submitRunMetrics','find','npx\x20nx\x20run-many\x20--target=','inherit','Waiter','DistributedAgentApi','next','defineProperty','getRunGroup','criticalErrorMessage','done','completed:\x20','then','readFileSync','__awaiter','error:\x20','completeRunGroupWithError','apply','RUN_GROUP_COMPLETED','warn','/nx.json','Waiting...','mkdirSync','printInvalidRunnerError','parse','No\x20new\x20messages\x20received\x20after\x20','number\x20of\x20tasks:\x20','Executing:\x20\x27','Distributed\x20Execution\x20Terminated','reset','retryDuring:\x20','existsSync','message','tasks','executionId:\x20','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','configuration','printRunGroupError','taskId','throw','@nrwl/nx-cloud','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','error','join','projects','__esModule','CIRCLE_STAGE','wait','CIRCLECI','status','We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','map','/lockfiles','note','strip-json-comments','startAgent','tasksRunnerOptions','NO_MESSAGES_TIMEOUT','VERBOSE_LOGGING','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','SIGTERM','toString','completedTasks','SIGINT','Critical\x20Error\x20in\x20Agent:\x20\x22','readdirSync','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','maxParallel','CIRCLE_JOB','.lock','env','projectName','value','--configuration=','params','Agent\x20','../../../utilities/environment','completedStatusCode','Other\x20Nx\x20Cloud\x20Agents\x20Detected','push','runner','true','executionId','getTime','assign','API\x20Response','length','completed','createUnchangedValueTimeout','ignore','target','./distributed-agent.api','Agent\x20was\x20terminated\x20via\x20SIGTERM','\x20seconds','writeFileSync','Error:','unlinkSync','\x20--projects=','Command\x20execution\x20failed\x20(distributed\x20task\x20execution:\x20','random','\x20--parallel\x20--max-parallel='];(function(_0xc65dbe,_0x1fcda0){const _0x54d58d=function(_0x457f6d){while(--_0x457f6d){_0xc65dbe['push'](_0xc65dbe['shift']());}};_0x54d58d(++_0x1fcda0);}(a6_0x1fcd,0x98));const a6_0x54d5=function(_0xc65dbe,_0x1fcda0){_0xc65dbe=_0xc65dbe-0x0;let _0x54d58d=a6_0x1fcd[_0xc65dbe];return _0x54d58d;};'use strict';var __awaiter=this&&this[a6_0x54d5('0x5b')]||function(_0x538c06,_0x33f151,_0x3af8c9,_0xef80a0){function _0x459845(_0x328c29){return _0x328c29 instanceof _0x3af8c9?_0x328c29:new _0x3af8c9(function(_0x2601b1){_0x2601b1(_0x328c29);});}return new(_0x3af8c9||(_0x3af8c9=Promise))(function(_0xd84f19,_0x2d6533){function _0x317be5(_0x1d55d8){try{_0x94b7c4(_0xef80a0['next'](_0x1d55d8));}catch(_0x31331c){_0x2d6533(_0x31331c);}}function _0x58f57a(_0xcf4bb){try{_0x94b7c4(_0xef80a0[a6_0x54d5('0x6')](_0xcf4bb));}catch(_0x4381d9){_0x2d6533(_0x4381d9);}}function _0x94b7c4(_0x1f4394){_0x1f4394[a6_0x54d5('0x57')]?_0xd84f19(_0x1f4394['value']):_0x459845(_0x1f4394[a6_0x54d5('0x27')])[a6_0x54d5('0x59')](_0x317be5,_0x58f57a);}_0x94b7c4((_0xef80a0=_0xef80a0[a6_0x54d5('0x5e')](_0x538c06,_0x33f151||[]))[a6_0x54d5('0x53')]());});};Object[a6_0x54d5('0x54')](exports,a6_0x54d5('0xc'),{'value':!![]});exports[a6_0x54d5('0x16')]=void 0x0;const child_process_1=require('child_process');const fs_1=require('fs');const stripJsonComments=require(a6_0x54d5('0x15'));const create_unchanged_value_timeout_1=require('../../../utilities/create-unchanged-value-timeout');const environment_1=require(a6_0x54d5('0x2b'));const metric_logger_1=require('../../../utilities/metric-logger');const waiter_1=require('../../../utilities/waiter');const print_run_group_error_1=require('../../error/print-run-group-error');const distributed_agent_api_1=require(a6_0x54d5('0x3a'));const print_invalid_runner_error_1=require('../../error/print-invalid-runner-error');const {output,workspaceRoot}=require(a6_0x54d5('0x4a'));function executeTasks(_0x4790f2,_0x5186e0){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x11f859=0x0;let _0x5038e3=null;const _0x4204f2=(0x0,create_unchanged_value_timeout_1[a6_0x54d5('0x37')])({'title':a6_0x54d5('0x66')+environment_1[a6_0x54d5('0x18')]/0x3e8+a6_0x54d5('0x3c'),'timeout':environment_1[a6_0x54d5('0x18')]});const _0x4542e1=new waiter_1[(a6_0x54d5('0x51'))]();let _0x2bda6b=[];const _0x1b4c53=new Date();let _0x12c428=![];while(!![]){if(environment_1[a6_0x54d5('0x19')]){output['note']({'title':'Fetching\x20tasks...'});}_0x5038e3=yield _0x5186e0[a6_0x54d5('0x0')](_0x5038e3?_0x5038e3[a6_0x54d5('0x31')]:null,_0x11f859,_0x2bda6b);if(environment_1[a6_0x54d5('0x19')]){output[a6_0x54d5('0x14')]({'title':a6_0x54d5('0x34'),'bodyLines':[a6_0x54d5('0x58')+_0x5038e3['completed'],a6_0x54d5('0x4b')+_0x5038e3[a6_0x54d5('0x10')],a6_0x54d5('0x6b')+_0x5038e3[a6_0x54d5('0x48')],a6_0x54d5('0x1')+_0x5038e3[a6_0x54d5('0x31')],a6_0x54d5('0x67')+_0x5038e3[a6_0x54d5('0x0')][a6_0x54d5('0x35')],a6_0x54d5('0x5c')+_0x5038e3[a6_0x54d5('0x56')],'maxParallel:\x20'+_0x5038e3[a6_0x54d5('0x22')]]});}if(_0x5038e3[a6_0x54d5('0x56')]){output['error']({'title':a6_0x54d5('0x69'),'bodyLines':[a6_0x54d5('0x3e'),_0x5038e3[a6_0x54d5('0x56')]]});process[a6_0x54d5('0x46')](0x0);}if((_0x5038e3===null||_0x5038e3===void 0x0?void 0x0:_0x5038e3['retryDuring'])&&(_0x5038e3===null||_0x5038e3===void 0x0?void 0x0:_0x5038e3['retryDuring'])!==0x0&&!_0x12c428&&new Date()[a6_0x54d5('0x32')]()-_0x1b4c53[a6_0x54d5('0x32')]()>_0x5038e3[a6_0x54d5('0x48')]){yield _0x4542e1[a6_0x54d5('0xe')]();continue;}if((_0x5038e3===null||_0x5038e3===void 0x0?void 0x0:_0x5038e3['status'])!==undefined){if(_0x5038e3['status']===a6_0x54d5('0x5f')||_0x5038e3[a6_0x54d5('0x10')]==='NO_FURTHER_TASKS_TO_RUN'){return;}}else if(_0x5038e3[a6_0x54d5('0x36')]){return;}_0x4204f2(_0x5038e3['tasks'][a6_0x54d5('0x12')](_0x31df43=>_0x31df43[a6_0x54d5('0x5')])[a6_0x54d5('0xa')](''));if(!_0x5038e3[a6_0x54d5('0x31')]){if(environment_1[a6_0x54d5('0x19')]){output[a6_0x54d5('0x14')]({'title':a6_0x54d5('0x62')});}yield _0x4542e1[a6_0x54d5('0xe')]();_0x11f859=0x0;_0x2bda6b=[];continue;}_0x4542e1[a6_0x54d5('0x6a')]();_0x12c428=!![];const _0x237d41=invokeTasksUsingRunMany(_0x4790f2,_0x5038e3[a6_0x54d5('0x31')],_0x5038e3[a6_0x54d5('0x0')],_0x5038e3[a6_0x54d5('0x22')]);_0x11f859=_0x237d41[a6_0x54d5('0x2c')];_0x2bda6b=_0x237d41[a6_0x54d5('0x1d')];}});}function readCompletedTasks(_0x5bda1a,_0x359c6d){const _0x3939c8=a6_0x54d5('0x41')+_0x359c6d+').\x20Tasks\x20hashes\x20haven\x27t\x20been\x20recorded.';let _0x1f1349;try{const _0x3b35a5=(0x0,environment_1[a6_0x54d5('0x45')])(_0x5bda1a);const _0x3d1d8a=_0x3b35a5+'/tasks-hashes-'+_0x359c6d;_0x1f1349=JSON['parse']((0x0,fs_1[a6_0x54d5('0x5a')])(_0x3d1d8a)[a6_0x54d5('0x1c')]());(0x0,fs_1[a6_0x54d5('0x3f')])(_0x3d1d8a);}catch(_0xd99c7c){throw new Error(_0x3939c8);}if(_0x1f1349[a6_0x54d5('0x35')]==0x0){throw new Error(_0x3939c8);}return _0x1f1349;}function invokeTasksUsingRunMany(_0x473683,_0x213518,_0x58ec82,_0x6eea39){let _0x65b739=0x0;const _0x3345f5=[];for(const _0xd9d4fe of groupByTarget(_0x58ec82)){const _0x1f9e89=_0xd9d4fe[a6_0x54d5('0x3')]?a6_0x54d5('0x28')+_0xd9d4fe[a6_0x54d5('0x3')]:'';const _0x40c2b7=_0x6eea39>0x1?a6_0x54d5('0x43')+_0x6eea39:'';const _0x4a9a10=a6_0x54d5('0x4f')+_0xd9d4fe['target']+'\x20'+_0x1f9e89+a6_0x54d5('0x40')+_0xd9d4fe['projects']['join'](',')+'\x20'+_0xd9d4fe[a6_0x54d5('0x29')]+_0x40c2b7;if(environment_1['VERBOSE_LOGGING']){output[a6_0x54d5('0x14')]({'title':a6_0x54d5('0x68')+_0x4a9a10+'\x27'});}try{(0x0,child_process_1['execSync'])(_0x4a9a10,{'stdio':[a6_0x54d5('0x38'),a6_0x54d5('0x50'),'inherit'],'env':Object[a6_0x54d5('0x33')](Object[a6_0x54d5('0x33')]({},process['env']),{'NX_CACHE_FAILURES':a6_0x54d5('0x30'),'NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x213518,'NX_STREAM_OUTPUT':'true','NX_PREFIX_OUTPUT':'true'})});_0x3345f5[a6_0x54d5('0x2e')](...readCompletedTasks(_0x473683,_0x213518));}catch(_0x5f083b){if(_0x5f083b[a6_0x54d5('0x10')]===environment_1[a6_0x54d5('0x1a')]){throw _0x5f083b;}else{_0x65b739=0x1;_0x3345f5['push'](...readCompletedTasks(_0x473683,_0x213518));}}}return{'completedStatusCode':_0x65b739,'completedTasks':_0x3345f5};}function groupByTarget(_0x4ee6d4){const _0x19a23a=[];_0x4ee6d4['forEach'](_0xa4c1ea=>{const _0x477a29=_0x19a23a[a6_0x54d5('0x4e')](_0x160c17=>_0x160c17[a6_0x54d5('0x39')]===_0xa4c1ea[a6_0x54d5('0x39')]&&_0x160c17[a6_0x54d5('0x3')]===_0xa4c1ea[a6_0x54d5('0x3')]);if(_0x477a29){_0x477a29[a6_0x54d5('0xb')]['push'](_0xa4c1ea[a6_0x54d5('0x26')]);}else{_0x19a23a[a6_0x54d5('0x2e')]({'target':_0xa4c1ea[a6_0x54d5('0x39')],'projects':[_0xa4c1ea[a6_0x54d5('0x26')]],'params':_0xa4c1ea[a6_0x54d5('0x29')],'configuration':_0xa4c1ea[a6_0x54d5('0x3')]});}});return _0x19a23a;}function getAgentName(){if(process[a6_0x54d5('0x25')][a6_0x54d5('0x49')]!==undefined){return process['env'][a6_0x54d5('0x49')];}else if(process[a6_0x54d5('0x25')]['CIRCLECI']!==undefined&&process[a6_0x54d5('0x25')][a6_0x54d5('0xd')]){return process['env'][a6_0x54d5('0xd')];}else if(process[a6_0x54d5('0x25')][a6_0x54d5('0xf')]!==undefined&&process[a6_0x54d5('0x25')][a6_0x54d5('0x23')]){return process[a6_0x54d5('0x25')][a6_0x54d5('0x23')];}else{return a6_0x54d5('0x2a')+Math['floor'](Math[a6_0x54d5('0x42')]()*0x186a0);}}function createAgentLockfileAndSetUpListeners(_0x106efa,_0x8ef844,_0x1db8e4){const _0xcbdb41=(0x0,environment_1['getNxCacheDirectory'])(_0x8ef844);const _0x5965b4=_0xcbdb41+a6_0x54d5('0x13');const _0x1e58c5=_0x5965b4+'/'+_0x1db8e4+a6_0x54d5('0x24');if(!(0x0,fs_1[a6_0x54d5('0x6c')])(_0x5965b4)){(0x0,fs_1[a6_0x54d5('0x63')])(_0x5965b4,{'recursive':!![]});}const _0x2567fc=(0x0,fs_1[a6_0x54d5('0x20')])(_0x5965b4);if(_0x2567fc[a6_0x54d5('0x35')]){if(_0x2567fc['includes'](_0x1db8e4+a6_0x54d5('0x24'))){output[a6_0x54d5('0x9')]({'title':a6_0x54d5('0x4c'),'bodyLines':[a6_0x54d5('0x11'),'','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.']});process[a6_0x54d5('0x46')](0x1);}output[a6_0x54d5('0x60')]({'title':a6_0x54d5('0x2d'),'bodyLines':[a6_0x54d5('0x47'),'',a6_0x54d5('0x2'),a6_0x54d5('0x21')]});}(0x0,fs_1[a6_0x54d5('0x3d')])(_0x1e58c5,'');process['on'](a6_0x54d5('0x46'),_0x370970=>{cleanupAgentLockfile(_0x1e58c5,_0x370970);});process['on'](a6_0x54d5('0x1b'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x106efa[a6_0x54d5('0x5d')](a6_0x54d5('0x3b'));cleanupAgentLockfile(_0x1e58c5,0x1);}));process['on'](a6_0x54d5('0x1e'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x106efa[a6_0x54d5('0x5d')]('Agent\x20was\x20terminated\x20via\x20SIGINT');cleanupAgentLockfile(_0x1e58c5,0x1);}));}function cleanupAgentLockfile(_0x118995,_0x302789){if((0x0,fs_1[a6_0x54d5('0x6c')])(_0x118995)){(0x0,fs_1[a6_0x54d5('0x3f')])(_0x118995);process[a6_0x54d5('0x46')](_0x302789);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x21e9cd=(0x0,environment_1[a6_0x54d5('0x55')])();if(!_0x21e9cd){(0x0,print_run_group_error_1[a6_0x54d5('0x4')])();return process[a6_0x54d5('0x46')](0x1);}output[a6_0x54d5('0x14')]({'title':a6_0x54d5('0x8')});const _0x3a89a7=JSON[a6_0x54d5('0x65')](stripJsonComments((0x0,fs_1[a6_0x54d5('0x5a')])(workspaceRoot+a6_0x54d5('0x61'))[a6_0x54d5('0x1c')]()))[a6_0x54d5('0x17')]['default'];if(_0x3a89a7[a6_0x54d5('0x2f')]!==a6_0x54d5('0x7')){(0x0,print_invalid_runner_error_1[a6_0x54d5('0x64')])();return process[a6_0x54d5('0x46')](0x1);}const _0x2b577c=_0x3a89a7[a6_0x54d5('0x44')];const _0x10584a=getAgentName();const _0x16a0db=new distributed_agent_api_1[(a6_0x54d5('0x52'))](_0x2b577c,_0x21e9cd,_0x10584a);createAgentLockfileAndSetUpListeners(_0x16a0db,_0x2b577c,_0x10584a);return executeTasks(_0x2b577c,_0x16a0db)[a6_0x54d5('0x59')](_0x169f89=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1[a6_0x54d5('0x4d')])(_0x2b577c);return _0x169f89;}))['catch'](_0x3682d1=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x16a0db['completeRunGroupWithError'](a6_0x54d5('0x1f')+_0x3682d1[a6_0x54d5('0x6d')]+'\x22');throw _0x3682d1;}));});}exports[a6_0x54d5('0x16')]=startAgent;