const a3_0x3640=['headers','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','mapRespToPerfEntry','data','response','createMetricRecorder','stack','Invalid\x20end\x20run\x20response','devDependencies','Run\x20completion\x20responded\x20with\x20`undefined`.','success','length','apply','status','map','terminalOutput','api','@nrwl/nx-cloud','/nx-cloud/runs/end','apiError','recordMetric','nxCloudVersion','createReqBody','axiosException','util','parse','machineInfo','defineProperty','Invalid\x20Nx\x20Cloud\x20response:\x20','note','../../../utilities/environment','promisify','CloudRunApi','axiosMultipleTries','runContext','../../../utilities/metric-logger','__esModule','urls','toString','then','Stack\x20Trace:','...','messages','endRun','post','slice','extractErrorMessage','throw','zlib','Run\x20Details:','getRunGroup','done','from','defaults','gzip','RunStart','stringify','startRun','runUrl','error','RUNNER_FAILURE_PERF_ENTRY','unknown','printDuration','Invalid\x20end\x20run\x20response:\x20','/nx-cloud/runs/start','next','message','__awaiter','RunEnd.\x20Completed\x20tasks','assign','value','VERBOSE_LOGGING'];(function(_0x3efe6d,_0x3640a7){const _0x5d8ca5=function(_0x2f9e70){while(--_0x2f9e70){_0x3efe6d['push'](_0x3efe6d['shift']());}};_0x5d8ca5(++_0x3640a7);}(a3_0x3640,0x16c));const a3_0x5d8c=function(_0x3efe6d,_0x3640a7){_0x3efe6d=_0x3efe6d-0x0;let _0x5d8ca5=a3_0x3640[_0x3efe6d];return _0x5d8ca5;};'use strict';var __awaiter=this&&this[a3_0x5d8c('0x3f')]||function(_0x22c294,_0x241545,_0x1e881d,_0x384180){function _0xee1280(_0x37469f){return _0x37469f instanceof _0x1e881d?_0x37469f:new _0x1e881d(function(_0x280762){_0x280762(_0x37469f);});}return new(_0x1e881d||(_0x1e881d=Promise))(function(_0x3034c1,_0x28857e){function _0x3a1e1c(_0xccc244){try{_0x4d6711(_0x384180[a3_0x5d8c('0x3d')](_0xccc244));}catch(_0xc4d39f){_0x28857e(_0xc4d39f);}}function _0x188966(_0x202629){try{_0x4d6711(_0x384180[a3_0x5d8c('0x2b')](_0x202629));}catch(_0x4e1e29){_0x28857e(_0x4e1e29);}}function _0x4d6711(_0x53eec1){_0x53eec1[a3_0x5d8c('0x2f')]?_0x3034c1(_0x53eec1[a3_0x5d8c('0x42')]):_0xee1280(_0x53eec1['value'])[a3_0x5d8c('0x23')](_0x3a1e1c,_0x188966);}_0x4d6711((_0x384180=_0x384180[a3_0x5d8c('0x8')](_0x22c294,_0x241545||[]))[a3_0x5d8c('0x3d')]());});};Object[a3_0x5d8c('0x17')](exports,a3_0x5d8c('0x20'),{'value':!![]});exports[a3_0x5d8c('0x1c')]=void 0x0;const axios_1=require('../../../utilities/axios');const environment_1=require(a3_0x5d8c('0x1a'));const fs_1=require('fs');const zlib_1=require(a3_0x5d8c('0x2c'));const util_1=require(a3_0x5d8c('0x14'));const metric_logger_1=require(a3_0x5d8c('0x1f'));const {output}=require('../../../utilities/nx-imports');class CloudRunApi{constructor(_0x2266cc,_0x4157ff,_0x2393e4,_0x369a7a){this[a3_0x5d8c('0x26')]=_0x2266cc;this[a3_0x5d8c('0x1e')]=_0x4157ff;this[a3_0x5d8c('0x16')]=_0x369a7a;this['apiAxiosInstance']=(0x0,axios_1['createApiAxiosInstance'])(_0x2393e4);}['startRun'](_0x257dc3,_0x41db9){var _0x4e8344;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3af6e1=(0x0,metric_logger_1[a3_0x5d8c('0x1')])(a3_0x5d8c('0x35'));try{const _0xa3d902={'meta':{'nxCloudVersion':this[a3_0x5d8c('0x11')]()},'branch':(0x0,environment_1['getBranch'])(),'runGroup':(0x0,environment_1[a3_0x5d8c('0x2e')])(),'distributedExecutionId':_0x257dc3,'hashes':_0x41db9};if(environment_1[a3_0x5d8c('0x43')]){output[a3_0x5d8c('0x19')]({'title':a3_0x5d8c('0x33'),'bodyLines':['\x0a'+JSON[a3_0x5d8c('0x34')](_0xa3d902,null,0x2)]});}const _0x32d84c=yield(0x0,axios_1[a3_0x5d8c('0x3a')])('RunStart\x20duration',()=>(0x0,axios_1[a3_0x5d8c('0x1d')])(()=>this['apiAxiosInstance'][a3_0x5d8c('0x28')](a3_0x5d8c('0x3c'),_0xa3d902)));_0x3af6e1['recordMetric']((0x0,metric_logger_1[a3_0x5d8c('0x46')])(_0x32d84c));if(_0x32d84c[a3_0x5d8c('0x47')]&&_0x32d84c[a3_0x5d8c('0x47')]['message']){this[a3_0x5d8c('0x26')][a3_0x5d8c('0x3e')]=_0x32d84c['data'][a3_0x5d8c('0x3e')];}if(!_0x32d84c[a3_0x5d8c('0x47')]||!_0x32d84c[a3_0x5d8c('0x47')]['urls']){this[a3_0x5d8c('0x26')][a3_0x5d8c('0xf')]=a3_0x5d8c('0x18')+JSON[a3_0x5d8c('0x34')](_0x32d84c[a3_0x5d8c('0x47')]);return{};}return _0x32d84c['data'][a3_0x5d8c('0x21')];}catch(_0x538087){_0x3af6e1[a3_0x5d8c('0x10')](((_0x4e8344=_0x538087===null||_0x538087===void 0x0?void 0x0:_0x538087['axiosException'])===null||_0x4e8344===void 0x0?void 0x0:_0x4e8344[a3_0x5d8c('0x0')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x538087[a3_0x5d8c('0x13')][a3_0x5d8c('0x0')]):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);this[a3_0x5d8c('0x26')][a3_0x5d8c('0xf')]=this['messages'][a3_0x5d8c('0x2a')](_0x538087,a3_0x5d8c('0xc'));return{};}});}[a3_0x5d8c('0x12')](_0xbb228d,_0x2cd71a,_0x5a04a7){const _0xa28803={'meta':{'nxCloudVersion':this[a3_0x5d8c('0x11')]()},'tasks':_0x2cd71a,'run':_0xbb228d,'linkId':_0x5a04a7,'machineInfo':this[a3_0x5d8c('0x16')]};return JSON[a3_0x5d8c('0x34')](_0xa28803);}[a3_0x5d8c('0x27')](_0x27c18a,_0x5aedb3,_0x657f0b){var _0x23cffa,_0x3c9f5d;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x5d8c('0x26')]['apiError'])return![];let _0x3ce2ef=this[a3_0x5d8c('0x12')](_0x27c18a,_0x5aedb3,_0x657f0b);if(_0x3ce2ef[a3_0x5d8c('0x7')]>0x14*0x3e8*0x3e8){_0x3ce2ef=this[a3_0x5d8c('0x12')](_0x27c18a,_0x5aedb3[a3_0x5d8c('0xa')](_0x32eee1=>Object[a3_0x5d8c('0x41')](Object[a3_0x5d8c('0x41')]({},_0x32eee1),{'hashDetails':undefined})));}const _0x227f4a=Buffer[a3_0x5d8c('0x30')](_0x3ce2ef);const _0x1fc532=yield(0x0,util_1[a3_0x5d8c('0x1b')])(zlib_1['gzip'])(_0x227f4a);const _0xe3ea49=(0x0,metric_logger_1['createMetricRecorder'])('endRun');try{if(environment_1[a3_0x5d8c('0x43')]){const _0x3551fd=_0x5aedb3['map'](_0x23d575=>{return Object[a3_0x5d8c('0x41')](Object[a3_0x5d8c('0x41')]({},_0x23d575),{'terminalOutput':_0x23d575['terminalOutput']?_0x23d575[a3_0x5d8c('0xb')][a3_0x5d8c('0x29')](0x0,0x14)+a3_0x5d8c('0x25'):undefined});});output[a3_0x5d8c('0x19')]({'title':a3_0x5d8c('0x40'),'bodyLines':['\x0a'+JSON[a3_0x5d8c('0x34')](_0x3551fd,null,0x2)]});}const _0x5bc412=yield(0x0,axios_1['printDuration'])('RunEnd\x20duration',()=>(0x0,axios_1[a3_0x5d8c('0x1d')])(()=>this['apiAxiosInstance'][a3_0x5d8c('0x28')](a3_0x5d8c('0xe'),_0x1fc532,{'headers':Object['assign'](Object[a3_0x5d8c('0x41')]({},this['apiAxiosInstance'][a3_0x5d8c('0x31')][a3_0x5d8c('0x44')]),{'Content-Encoding':a3_0x5d8c('0x32'),'Content-Type':'application/octet-stream'})})));if(_0x5bc412){_0xe3ea49[a3_0x5d8c('0x10')]((0x0,metric_logger_1[a3_0x5d8c('0x46')])(_0x5bc412));if(_0x5bc412[a3_0x5d8c('0x47')]&&_0x5bc412['data'][a3_0x5d8c('0x36')]&&_0x5bc412['data'][a3_0x5d8c('0x9')]===a3_0x5d8c('0x6')){this[a3_0x5d8c('0x1e')][a3_0x5d8c('0x36')]=_0x5bc412[a3_0x5d8c('0x47')][a3_0x5d8c('0x36')];return!![];}if(_0x5bc412[a3_0x5d8c('0x47')]&&_0x5bc412['data'][a3_0x5d8c('0x9')]){this[a3_0x5d8c('0x26')]['apiError']='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x5d8c('0x34')](_0x5bc412[a3_0x5d8c('0x47')][a3_0x5d8c('0x3e')]);}else if(_0x5bc412['data']&&typeof _0x5bc412[a3_0x5d8c('0x47')]==='string'){if(_0x5bc412[a3_0x5d8c('0x47')]!==a3_0x5d8c('0x6')){this['messages'][a3_0x5d8c('0xf')]=a3_0x5d8c('0x3b')+JSON['stringify'](_0x5bc412[a3_0x5d8c('0x47')]);}}else{this[a3_0x5d8c('0x26')][a3_0x5d8c('0xf')]=a3_0x5d8c('0x3b')+JSON[a3_0x5d8c('0x34')](_0x5bc412['data']);}if(environment_1['VERBOSE_LOGGING']){output[a3_0x5d8c('0x19')]({'title':a3_0x5d8c('0x3'),'bodyLines':[JSON[a3_0x5d8c('0x34')](_0x5bc412['data'],null,0x2)]});}}else{output[a3_0x5d8c('0x37')]({'title':a3_0x5d8c('0x45'),'bodyLines':[a3_0x5d8c('0x5'),a3_0x5d8c('0x2d'),JSON[a3_0x5d8c('0x34')](_0x27c18a,null,0x2),a3_0x5d8c('0x24'),JSON['stringify'](new Error()[a3_0x5d8c('0x2')],null,0x2)]});}return![];}catch(_0x279df5){_0xe3ea49[a3_0x5d8c('0x10')](((_0x23cffa=_0x279df5===null||_0x279df5===void 0x0?void 0x0:_0x279df5[a3_0x5d8c('0x13')])===null||_0x23cffa===void 0x0?void 0x0:_0x23cffa[a3_0x5d8c('0x0')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x279df5[a3_0x5d8c('0x13')][a3_0x5d8c('0x0')]):metric_logger_1[a3_0x5d8c('0x38')]);const _0x474850=(_0x3c9f5d=_0x279df5[a3_0x5d8c('0x13')])!==null&&_0x3c9f5d!==void 0x0?_0x3c9f5d:_0x279df5;this[a3_0x5d8c('0x26')][a3_0x5d8c('0xf')]=this[a3_0x5d8c('0x26')][a3_0x5d8c('0x2a')](_0x474850,a3_0x5d8c('0xc'));return![];}});}[a3_0x5d8c('0x11')](){try{const _0x142bb1=JSON[a3_0x5d8c('0x15')]((0x0,fs_1['readFileSync'])('package.json')[a3_0x5d8c('0x22')]());return _0x142bb1[a3_0x5d8c('0x4')][a3_0x5d8c('0xd')];}catch(_0x5b82c1){return a3_0x5d8c('0x39');}}}exports['CloudRunApi']=CloudRunApi;